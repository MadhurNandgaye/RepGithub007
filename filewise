public void TriggerEmailAlertForWorkerDrop(IEnumerable<string> workersWithDrop, int percentageDrop)
{
    try
    {
        // Subject for the email
        string subject = $"Worker Drop Alert - {percentageDrop}% decrease detected";

        // Build the email body in one go (HTML format)
        string emailBody = "<html><body>";
        emailBody += $"<p>Alert: We detected more than {percentageDrop}% decrease in workers.</p>";
        emailBody += $"<p>Time: {DateTime.UtcNow}</p>";

        if (workersWithDrop != null && workersWithDrop.Any())
        {
            emailBody += "<ul>"; // using unordered list since we don't have structured fields
            foreach (var workerInfo in workersWithDrop)
            {
                emailBody += $"<li>{workerInfo}</li>"; // each string contains WorkerType, counts, drop %
            }
            emailBody += "</ul>";
        }
        else
        {
            emailBody += "<p>No worker drops detected.</p>";
        }

        emailBody += "<p>Please investigate immediately.</p>";
        emailBody += "</body></html>";

        // Send the email
        _emailService.SendEmailInHtmlFormat(
            _applicationSettings.FromEmailAddress,
            _applicationSettings.ToEmailAddress,
            subject,
            emailBody
        );

        _logger.LogInformation("Worker drop alert email triggered successfully.");
    }
    catch (Exception ex)
    {
        _logger.LogError($"Exception occurred while sending Worker Drop alert email: {ex}");
    }
}
